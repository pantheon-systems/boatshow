<!-- Bing Ads Pixel -->
<script>(function(w,d,t,r,u){var f,n,i;w[u]=w[u]||[],f=function(){var o={ti:"5117211"};o.q=w[u],w[u]=new UET(o),w[u].push("pageLoad")},n=d.createElement(t),n.src=r,n.async=1,n.onload=n.onreadystatechange=function(){var s=this.readyState;s&&s!=="loaded"&&s!=="complete"||(f(),n.onload=n.onreadystatechange=null)},i=d.getElementsByTagName(t)[0],i.parentNode.insertBefore(n,i)})(window,document,"script","//bat.bing.com/bat.js","uetq");</script><noscript><img src="//bat.bing.com/action/0?ti=5117211&Ver=2" height="0" width="0" style="display:none; visibility: hidden;" /></noscript>

<!-- BEGIN: Marin Software Tracking Script (Confirmation Page) -->
<script type='text/javascript'>
    var _mTrack = _mTrack || [];
    _mTrack.push(['addTrans', {
        currency: 'USD',
        items: [{
            convType: 'MRMT'
        }]
    }]);
    _mTrack.push(['processOrders']);
    (function () {
        var mClientId = '3933ju54517';
        var mProto = (('https:' == document.location.protocol) ? 'https://' : 'http://');
        var mHost = 'tracker.marinsm.com';
        var mt = document.createElement('script'); mt.type = 'text/javascript'; mt.async = true; mt.src = mProto + mHost + '/tracker/async/' + mClientId + '.js';
        var fscr = document.getElementsByTagName('script')[0]; fscr.parentNode.insertBefore(mt, fscr);
    })();
</script>
<noscript>
    <img width='1' height='1' src='https://tracker.marinsm.com/tp?act=2&cid=3933ju54517&script=no' />
</noscript>
<!-- END: Copyright Marin Software -->

<!-- BEGIN: Yahoo Pixel NEW -->
<script type="application/javascript">(function(w,d,t,r,u){w[u]=w[u]||[];w[u].push({'projectId':'10000','properties':{'pixelId':'10022936'}});var s=d.createElement(t);s.src=r;s.async=true;s.onload=s.onreadystatechange=function(){var y,rs=this.readyState,c=w[u];if(rs&&rs!="complete"&&rs!="loaded"){return}try{y=YAHOO.ywa.I13N.fireBeacon;w[u]=[];w[u].push=function(p){y([p])};y(c)}catch(e){}};var scr=d.getElementsByTagName(t)[0],par=scr.parentNode;par.insertBefore(s,scr)})(window,document,"script","https://s.yimg.com/wi/ytc.js","dotq");</script>
<!-- END: Yahoo Pixel -->

<script type='text/javascript'>
    console.time('redir');
    var checker;
    var checkedCount = 0;
    var googleConversionLoaded = false;
    var bingLoaded = false;
    var yahooLoaded = false;
    var marinLoaded = false;
    var googleEventTrackingSent = false;
    //var runTracking = <%= runTracking %>;

    //console.log('<%= manufacturerName %>', '<%= manufacturerUrl %>');

    function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }

    function redirect() {
        console.log('redirecting...', getParameterByName('manufacturerName'));
        console.timeEnd('redir');
        if (window.localStorage && typeof( window.localStorage.notRedirect ) === 'undefined') {
            window.location.href = getParameterByName('manufacturerURL');
        }
    }

    function tryRedirect() {
        if (++checkedCount >= 65 || !runTracking) {
            console.warn('A script failed loading or tracking is disabled')
            clearInterval(checker);
            redirect();
        }

        console.log('tryRedirect: checkedCount', checkedCount);
        //console.log('runTracking', runTracking);
        //console.log('bingLoaded', bingLoaded);
        //console.log('yahooLoaded', yahooLoaded);
        //console.log('googleEventTrackingSent', googleEventTrackingSent);

        if (runTracking && googleConversionLoaded && bingLoaded && yahooLoaded && marinLoaded && googleEventTrackingSent) {
            clearInterval(checker);
            redirect();
        }
    }

    // Google analytics tag
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-2868320-1', 'auto');
    ga('send', 'pageview', {
        'cookieDomain': 'discoverboating.com',
        'hitCallback': function() {
            console.log('googleEventTrackingSent = true');
            googleEventTrackingSent = true;
        }
    });
    ga('send', 'event', 'Manufacturer-link', 'Click', '<%= manufacturerName %>');

    var checkLoaded = function() {
        if ( typeof window.YAHOO !== "undefined" && ! yahooLoaded ) {
            console.log('yahooLoaded = true');
            yahooLoaded = true;
        }
        // when _mTrack.length is 0 it means Marin Software has processed
        if ( window._mTrack.length === 0 && !marinLoaded) {
            console.log('marinLoaded = true');
            marinLoaded = true;
        }
        // when uetq.domain has a value bing has loaded
        if (typeof window.uetq.domain !== 'undefined' && ! bingLoaded ) {
            console.log('bingLoaded = true');
            bingLoaded = true;
        }
        tryRedirect();
    }

    checker = setInterval( checkLoaded, 50 );

    // Google conversion tag
    var img = document.createElement('img');
    var goalId = 994463086;
    var randomNum = new Date().getMilliseconds();
    var value = 0;
    var label = 'Y7LCCMqjwAcQ7pqZ2gM';
    var url = encodeURI(location.href);
    var trackUrl = '//www.googleadservices.com/pagead/conversion/' + goalId + '/?random=' + randomNum + '&value=' + value + '&label=' + label + '&guid=ON&script=0&url=' + url;
    img.setAttribute('id', 'google-conversion');
    img.src = trackUrl;
    document.body.appendChild(img);

    $('#google-conversion').load(function () {
        console.log('googleConversionLoaded = true');
        googleConversionLoaded = true;
    });

</script>
